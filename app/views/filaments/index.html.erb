<!-- Hero Section -->
<div class="text-center mb-5">
    <h3 class="display-5 fw-bold text-primary mb-3"><%= t('filaments.index.title') %></h3>
    <p class="lead text-muted mb-4"><%= t('filaments.index.subtitle') %></p>
    <div class="d-flex gap-3 justify-content-center">
        <%= link_to t('filaments.index.add_new'), new_filament_path, class: "btn btn-primary btn-lg" %>
        <%= link_to t('filaments.import.button'), import_form_filaments_path, class: "btn btn-outline-primary btn-lg" %>
    </div>
</div>

<!-- Search and Filter Section with Typehead -->
<% if @filaments.any? || params[:q].present? %>
<div class="card mb-4" data-controller="search" data-search-url-value="<%= filaments_path %>">
    <div class="card-body">
        <%= search_form_for @q, url: filaments_path,
            html: {
              class: "row g-3",
              data: {
                turbo_frame: :filament_results,
                search_target: "form"
              }
            } do |form| %>
            <div class="col-md-6">
                <%= form.search_field :name_or_brand_or_color_cont,
                    placeholder: t('filaments.index.search_placeholder'),
                    class: "form-control",
                    data: {
                      search_target: "input",
                      action: "input->search#search"
                    } %>
            </div>
            <%= render Forms::SelectFieldComponent.new(
              form: form,
              attribute: :material_type_eq,
              choices: [['All Materials', '']] + @material_types.map { |t| [t, t] },
              label: false,
              wrapper_class: "col-md-6",
              html_options: {
                data: { action: "change->search#search" }
              },
              select_options: { selected: params.dig(:q, :material_type_eq) }
            ) %>
        <% end %>
    </div>
</div>
<% end %>

<%= turbo_frame_tag :filament_results do %>
    <% if @filaments.any? %>
        <div class="row g-4">
            <% @filaments.each do |filament| %>
                <%= render Cards::FilamentCardComponent.new(filament: filament, current_user: current_user) %>
            <% end %>
        </div>
    <% elsif @q.present? %>
        <%= render Shared::EmptyStateComponent.new(
          title: t('filaments.index.no_results.title'),
          description: t('filaments.index.no_results.description', query: @q),
          action_text: t('filaments.index.clear_search'),
          action_url: filaments_path,
          action_variant: "secondary"
        ) %>
    <% else %>
        <%= render Shared::EmptyStateComponent.new(
          title: t('filaments.index.empty_state.title'),
          description: t('filaments.index.empty_state.description'),
          action_text: t('filaments.index.empty_state.add_first'),
          action_url: new_filament_path
        ) %>
    <% end %>
<% end %>

