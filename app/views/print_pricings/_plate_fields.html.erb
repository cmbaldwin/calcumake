<div class="nested-form-item card mb-3" data-nested-form-target="item" data-plate data-plate-id="<%= f.object.object_id %>">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h6 class="mb-0">
      <%= t('print_pricing.sections.plate') %>
      <span class="plate-number badge bg-secondary"></span>
    </h6>
    <button type="button"
            class="btn btn-sm btn-outline-danger"
            data-action="nested-form#remove">
      <%= t('actions.delete') %>
    </button>
  </div>
  <div class="card-body">
    <%= f.hidden_field :_destroy %>

    <div class="row g-3">
      <!-- Print Time -->
      <div class="col-12">
        <div class="row g-2">
          <div class="col-md-3">
            <%= f.label :printing_time_hours, t('print_pricing.fields.print_time_hours'), class: "form-label" %>
            <%= f.number_field :printing_time_hours, min: 0, step: 1, value: f.object.printing_time_hours || 0, class: "form-control" %>
          </div>
          <div class="col-md-3">
            <%= f.label :printing_time_minutes, t('print_pricing.fields.print_time_minutes'), class: "form-label" %>
            <%= f.number_field :printing_time_minutes, min: 0, max: 59, step: 1, value: f.object.printing_time_minutes || 0, class: "form-control" %>
          </div>
        </div>
      </div>

      <!-- Filaments Section -->
      <div class="col-12" data-controller="filament-list"
           data-plate-filament-container="<%= f.object.object_id %>"
           data-filament-list-max-items-value="16"
           data-filament-list-min-items-value="1"
           data-filament-list-item-name-value="filament"
           data-filament-list-add-button-text-value="<%= t('filaments.buttons.add_filament') %>"
           data-filament-list-currency-symbol-value="<%= currency_symbol(current_user.default_currency) %>"
           data-filament-list-dynamic-list-outlet=".filament-dynamic-list">

        <div class="filament-dynamic-list" data-controller="dynamic-list">
          <div class="mb-3">
            <h6 class="mb-0"><%= t('print_pricing.sections.filaments') %></h6>
          </div>

          <div data-filament-list-target="container" data-dynamic-list-target="container">
            <%= f.fields_for :plate_filaments do |pf_form| %>
              <%= render 'print_pricings/plate_filament_fields', f: pf_form, user_filaments: current_user.filaments %>
            <% end %>
          </div>

          <!-- Template for new filaments -->
          <template data-filament-list-target="template" data-dynamic-list-target="template">
            <%= f.fields_for :plate_filaments, PlateFilament.new, child_index: 'NEW_RECORD' do |pf_form| %>
              <%= render 'print_pricings/plate_filament_fields', f: pf_form, user_filaments: current_user.filaments %>
            <% end %>
          </template>

          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="form-text mb-0">
              <%= t('print_pricing.help.filaments_limit') %>
            </div>
            <button type="button"
                    class="btn btn-sm btn-success"
                    data-action="filament-list#add"
                    data-dynamic-list-target="addButton">
              + <%= t('filaments.buttons.add_filament') %>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
