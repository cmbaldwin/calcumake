<%= render "shared/breadcrumbs", items: [
  { name: t('print_pricing.title'), url: print_pricings_path },
  { name: @print_pricing.job_name, url: print_pricing_path(@print_pricing) }
] %>

<!-- Header -->
<div class="mb-4">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div class="flex-grow-1">
                <h1 class="h2 text-primary mb-2"><%= @print_pricing.job_name %></h1>
                <div class="text-muted">
                    <span class="me-3"><%= format_detailed_creation_date(@print_pricing) %></span>
                    <span class="badge bg-secondary">
                        <%= t('print_pricing.printed_times', count: @print_pricing.times_printed) %>
                    </span>
                </div>
            </div>
            <div>
                <%= pricing_show_actions(@print_pricing) %>
            </div>
        </div>
    </div>
</div>

<!-- Cost Summary Card -->
<div class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0 h5"><%= t('print_pricing.cost_summary') %></h3>
            <span class="badge bg-success fs-5">
                <%= @print_pricing.default_currency %> <%= format_currency(@print_pricing.final_price, @print_pricing.default_currency) %>
            </span>
        </div>
    </div>
    <div class="card-body">

        <div class="row g-3">
            <% if @print_pricing.total_filament_cost > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.filament') %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.total_filament_cost, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>

            <% if @print_pricing.total_electricity_cost > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.electricity') %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.total_electricity_cost, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>

            <% if @print_pricing.total_labor_cost > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.labor') %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.total_labor_cost, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>

            <% if @print_pricing.total_machine_upkeep_cost > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.machine') %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.total_machine_upkeep_cost, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>

            <% if @print_pricing.other_costs && @print_pricing.other_costs > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.other') %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.other_costs, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>

            <% if @print_pricing.vat_percentage && @print_pricing.vat_percentage > 0 %>
            <div class="col-md-6">
                <div class="d-flex justify-content-between p-2 border rounded">
                    <span class="fw-medium"><%= t('print_pricing.cost_breakdown.vat', percentage: @print_pricing.vat_percentage) %></span>
                    <span class="text-end"><%= format_currency_with_symbol(@print_pricing.calculate_subtotal * @print_pricing.vat_percentage / 100, @print_pricing.default_currency) %></span>
                </div>
            </div>
            <% end %>
        </div>
    </div>
</div>

<!-- Invoices Section -->
<%= turbo_frame_tag "invoices_section" do %>
<div class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0 h5"><%= t('invoices.title') %></h3>
            <div class="d-grid gap-2">
                <%= link_to new_print_pricing_invoice_path(@print_pricing), class: "btn btn-primary", data: { turbo_frame: "_top" } do %>
                <%= t('invoices.new_invoice') %>
                <% end %>
            </div>
        </div>
    </div>
    <div class="card-body">
        <% if @print_pricing.invoices.any? %>
        <% @print_pricing.invoices.recent.each do |invoice| %>
            <%= render InvoiceCardComponent.new(invoice: invoice) %>
        <% end %>
        <% else %>
        <div class="text-center py-4">
            <p class="text-muted mt-3 mb-2"><%= t('invoices.no_invoices') %></p>
            <p class="text-muted small"><%= t('invoices.create_first_invoice') %></p>
            <%= link_to t('invoices.create_invoice'), new_print_pricing_invoice_path(@print_pricing), class: "btn btn-primary mt-2", data: { turbo_frame: "_top" } %>
        </div>
        <% end %>
    </div>
</div>
<% end %>

<!-- Details Sections -->
<div class="row g-4">
    <% cost_breakdown_sections(@print_pricing).each do |section| %>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><%= section[:title] %></h5>
            </div>
            <div class="card-body">
                <% section[:items].each do |label, value| %>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted"><%= label %></span>
                    <span class="fw-medium"><%= value %></span>
                </div>
                <% end %>
            </div>
        </div>
    </div>
    <% end %>
</div>

<!-- Navigation Actions -->
<div class="d-flex gap-3 justify-content-center mt-4">
    <%= link_to print_pricings_path, class: "btn btn-outline-secondary" do %>
    <span><%= t('print_pricing.back_to_all') %></span>
    <% end %>
    <%= link_to new_print_pricing_path, class: "btn btn-primary" do %>
    <span><%= t('print_pricing.create_new') %></span>
    <% end %>
</div>