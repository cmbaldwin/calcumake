<!-- Hero Section -->
<div class="text-center mb-5">
    <h3 class="display-5 fw-bold text-primary mb-3"><%= t('clients.index.title') %></h3>
    <p class="lead text-muted mb-4"><%= t('clients.index.subtitle') %></p>
    <%= link_to t('clients.index.add_new'), new_client_path, class: "btn btn-primary btn-lg" %>
</div>

<!-- Search Section -->
<% if @clients.any? || params[:q].present? %>
<div class="card mb-4" data-controller="search" data-search-url-value="<%= clients_path %>">
    <div class="card-body">
        <%= search_form_for @q, url: clients_path,
            html: {
              class: "row g-3",
              data: {
                turbo_frame: :client_results,
                search_target: "form"
              }
            } do |form| %>
            <div class="col-md-12">
                <%= form.search_field :name_or_company_name_or_email_cont,
                    placeholder: t('clients.index.search_placeholder'),
                    class: "form-control",
                    data: {
                      search_target: "input",
                      action: "input->search#search"
                    } %>
            </div>
        <% end %>
    </div>
</div>
<% end %>

<%= turbo_frame_tag :client_results do %>
<% if @clients.any? %>
<div class="row g-4">
    <% @clients.each do |client| %>
    <div class="col-lg-4 col-md-6">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-primary"><%= client.name %></h5>
                <% if client.company_name.present? %>
                <span class="badge bg-success"><%= truncate(client.company_name, length: 20) %></span>
                <% end %>
            </div>

            <div class="card-body">
                <div class="mb-3">
                    <% if client.company_name.present? %>
                    <div class="d-flex justify-content-between py-2 border-bottom">
                        <span class="fw-medium text-muted"><%= t('clients.fields.company_name') %>:</span>
                        <span class="fw-bold"><%= truncate(client.company_name, length: 20) %></span>
                    </div>
                    <% end %>
                    <% if client.email.present? %>
                    <div class="d-flex justify-content-between py-2 border-bottom">
                        <span class="fw-medium text-muted"><%= t('clients.fields.email') %>:</span>
                        <span class="fw-bold"><%= truncate(client.email, length: 25) %></span>
                    </div>
                    <% end %>
                    <% if client.phone.present? %>
                    <div class="d-flex justify-content-between py-2 border-bottom">
                        <span class="fw-medium text-muted"><%= t('clients.fields.phone') %>:</span>
                        <span class="fw-bold"><%= client.phone %></span>
                    </div>
                    <% end %>
                    <div class="d-flex justify-content-between py-2">
                        <span class="fw-medium text-muted"><%= t('clients.card.invoices') %>:</span>
                        <span class="fw-bold"><%= client.invoices.count %></span>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div class="d-flex justify-content-center">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <%= t('actions.actions') %>
                        </button>
                        <ul class="dropdown-menu">
                            <li><%= link_to t('actions.view'), client, class: "dropdown-item", data: { turbo_frame: "_top" } %></li>
                            <li><%= link_to t('actions.edit'), edit_client_path(client), class: "dropdown-item", data: { turbo_frame: "_top" } %></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><%= link_to t('actions.delete'), client, method: :delete,
                          confirm: t('clients.confirm_delete', name: client.name),
                          class: "dropdown-item text-danger",
                          data: { turbo_method: :delete, turbo_confirm: t('clients.confirm_delete', name: client.name) } %></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <% end %>
</div>

<% if @q.present? && @clients.empty? %>
<!-- No Search Results -->
<div class="text-center py-5">
    <div class="card border-0 bg-light">
        <div class="card-body py-5">
            <h3 class="text-muted mb-3"><%= t('clients.index.no_results.title') %></h3>
            <p class="text-muted mb-4"><%= t('clients.index.no_results.description') %></p>
            <%= link_to t('clients.index.clear_search'), clients_path, class: "btn btn-secondary" %>
        </div>
    </div>
</div>
<% end %>

<% else %>
<!-- Empty State -->
<div class="text-center py-5">
    <div class="card border-0 bg-light">
        <div class="card-body py-5">
            <h3 class="text-muted mb-3"><%= t('clients.index.empty_state.title') %></h3>
            <p class="text-muted mb-4"><%= t('clients.index.empty_state.description') %></p>
            <%= link_to t('clients.index.empty_state.add_first'), new_client_path, class: "btn btn-primary" %>
        </div>
    </div>
</div>
<% end %>
<% end %>
